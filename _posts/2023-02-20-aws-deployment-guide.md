---
keywords: fastai
description: A step-by-step guide and description of methods and processes for deploying your Flask website. 
title: AWS Deployment Guide
toc: true
badges: false
categories: [AWS]
nb_path: _notebooks/2023-02-20-aws-deployment-guide.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2023-02-20-aws-deployment-guide.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Accessing-AWS-and-Server-Setup">Accessing AWS and Server Setup<a class="anchor-link" href="#Accessing-AWS-and-Server-Setup"> </a></h2><blockquote><p>Amazon Web Services - Electric Cloud Compute Setup</p>
</blockquote>
<ul>
<li>First, head over to <a href="https://signin.aws.amazon.com/signin?redirect_uri=https%3A%2F%2Faws.amazon.com%2Fmarketplace%2Fmanagement%2Fsignin%3Fstate%3DhashArgs%2523%26isauthcode%3Dtrue&amp;client_id=arn%3Aaws%3Aiam%3A%3A015428540659%3Auser%2Faws-mp-seller-management-portal&amp;forceMobileApp=0&amp;code_challenge=THsilLdgva3JIi0fNok6wZKstoMR3YEyjRDJYJfjT7A&amp;code_challenge_method=SHA-256">AWS</a> and select the "Instances" dropdown. Once you click "Instances" you will see a couple different ones pop up. Based on who your teacher is, select one of the following. 
<img src="/FASTPAGES/images/copied_from_nb/ghtop_images/instances.png" alt=""></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Once here, run the following line of code to observe the ports which are currently in use.</p>
<div class="highlight"><pre><span></span>$ sudo docker ps
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Docker-and-docker-compose.yml">Docker and docker-compose.yml<a class="anchor-link" href="#Docker-and-docker-compose.yml"> </a></h2><ul>
<li>Update docker-compose.yml and Docker files on corresponding VSCode, on your local machine</li>
<li>Choose a port which is not in use and then change docker-compose.yml to the new, unused port you have decided upon. Should be in the following format: xxx:8086 where xxx is new port</li>
</ul>
<h3 id="Dockerfile:">Dockerfile:<a class="anchor-link" href="#Dockerfile:"> </a></h3><ul>
<li>Now you want to check that your Dockerfile matches the following:</li>
</ul>
<div class="highlight"><pre><span></span>FROM docker.io/python:3.10

WORKDIR /

<span class="c1"># --- [Install python and pip] ---</span>
RUN apt-get update <span class="o">&amp;&amp;</span> apt-get upgrade -y <span class="o">&amp;&amp;</span> <span class="se">\</span>
    apt-get install -y python3 python3-pip git
COPY . /app

RUN pip install --no-cache-dir -r requirements.txt
RUN pip install gunicorn

ENV <span class="nv">GUNICORN_CMD_ARGS</span><span class="o">=</span><span class="s2">&quot;--workers=3 --bind=0.0.0.0:8080&quot;</span>

EXPOSE <span class="m">8080</span>

CMD <span class="o">[</span> <span class="s2">&quot;gunicorn&quot;</span>, <span class="s2">&quot;main:app&quot;</span> <span class="o">]</span>
</pre></div>
<ul>
<li>Now, run  <code>bash
sudo docker-compose up</code> in VSCode terminal to make sure it builds correctly. </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><p>Error-proofing! If any errors occur in terminal you will need to revise previous steps. Work in small steps to succeed, test as you go to make sure everything is working in accordance.</p>
</li>
<li><p>Once everything is working, no errors in site, stage and commit all changes to the docker-compose.yml, and of course, to the Docker.</p>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Cloning-and-Relocating-Project-Location">Cloning and Relocating Project Location<a class="anchor-link" href="#Cloning-and-Relocating-Project-Location"> </a></h2><ul>
<li>On AWS, go back to the instance you chose, either Mr. Mort's or Mr. Yeung's. </li>
<li>Once you are in the instace, run </li>
</ul>
<div class="highlight"><pre><span></span>ls
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>this allows you to check other repo names, so don't select the name of one which already appears once you run this</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Now run the following: </li>
</ul>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span>
$ git clone https://github.com/nighthawkcoders/flask_portfolio.git <span class="c1">#input your own GitHub HTTPs link here, not Mr. Mort&#39;s. This was just for example</span>
$ <span class="nb">cd</span> input-yours
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Now that you will be cd'd into your repo, run this:</li>
</ul>
<div class="highlight"><pre><span></span>docker-compose up -d --build
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>To make sure app is up and running, run</li>
</ul>
<div class="highlight"><pre><span></span>curl localhost:xxx <span class="c1"># where xxx is the port you selected from earlier</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Testing-Docker-Web-using-IP">Testing Docker Web using IP<a class="anchor-link" href="#Testing-Docker-Web-using-IP"> </a></h1><ul>
<li>Enabling Nginx is crucial</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Install Nginx:<div class="highlight"><pre><span></span>$ sudo apt install nginx
</pre></div>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Go into directory of Nginx files<div class="highlight"><pre><span></span>$ <span class="nb">cd</span> /etc/nginx/sites-available
</pre></div>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Open editor to simulate your personal Nginx configuration<div class="highlight"><pre><span></span>$ sudo nano input-yours <span class="c1"># input name of whatever your nginx file is called</span>
</pre></div>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><p>Now edit your Nginx server configuration, specifically, modify the following:</p>
<ul>
<li>IP Address: </li>
<li>docker-compose, proxy pass Port: 8086</li>
</ul>
</li>
<li><p>Must Do's</p>
</li>
<li><p>establish unique, valid name for nginx file</p>
</li>
<li><p>Duck DNS name for server - see Jeffrey's guide <a href="https://moonpiedumplings.github.io/quartotest/posts/duckdns/">here</a>.</p>
</li>
<li><p>Use format below to write into your congif file:</p>
<div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
  <span class="kn">listen</span> <span class="s">[::]:80</span><span class="p">;</span>
  <span class="kn">server_name</span> <span class="mi">3</span><span class="s">.233.212.71</span><span class="p">;</span>
  <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
      <span class="kn">proxy_pass</span> <span class="s">http://localhost:8086</span><span class="p">;</span>
      <span class="c1"># Simple requests</span>
      <span class="kn">if</span> <span class="s">(</span><span class="nv">$request_method</span> <span class="p">~</span><span class="sr">*</span> <span class="s">&quot;(GET|POST)&quot;)</span> <span class="p">{</span>
              <span class="kn">add_header</span> <span class="s">&quot;Access-Control-Allow-Origin&quot;</span>  <span class="s">*</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1"># Preflight requests</span>
      <span class="kn">if</span> <span class="s">(</span><span class="nv">$request_method</span> <span class="p">=</span> <span class="s">OPTIONS</span> <span class="s">)</span> <span class="p">{</span>
              <span class="kn">add_header</span> <span class="s">&quot;Access-Control-Allow-Origin&quot;</span>  <span class="s">*</span><span class="p">;</span>
              <span class="kn">add_header</span> <span class="s">&quot;Access-Control-Allow-Methods&quot;</span> <span class="s">&quot;GET,</span> <span class="s">POST,</span> <span class="s">OPTIONS,</span> <span class="s">HEAD&quot;</span><span class="p">;</span>
              <span class="kn">add_header</span> <span class="s">&quot;Access-Control-Allow-Headers&quot;</span> <span class="s">&quot;Authorization,</span> <span class="s">Origin,</span> <span class="s">X-Requested-With,</span> <span class="s">Content-Type,</span> <span class="s">Accept&quot;</span><span class="p">;</span>
              <span class="kn">return</span> <span class="mi">200</span><span class="p">;</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Time-to-Activate-Nginx-Config">Time to Activate Nginx Config<a class="anchor-link" href="#Time-to-Activate-Nginx-Config"> </a></h2><ul>
<li>Enable your Nginx server config<div class="highlight"><pre><span></span>$ sudo ln -s /etc/nginx/sites-available/input-yours /etc/nginx/sites-enabled <span class="c1"># input name of your nginx file</span>
$ sudo nginx -t
</pre></div>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Again, error proof!</li>
<li>Check documentation to make sure you aren't missing any semicolon at end of server, or proxy_pass code. </li>
<li>If there aren't any errors, restart your nginx so that the server can activate the files<div class="highlight"><pre><span></span>$ sudo systemctl restart nginx
</pre></div>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>make sure server is running on live browser</li>
<li>you can do this by doing <a href="http://(name">http://(name</a> of your domain)</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Prep-Docker-Web-App-through-DNS">Prep Docker Web App through DNS<a class="anchor-link" href="#Prep-Docker-Web-App-through-DNS"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>certbot config:<div class="highlight"><pre><span></span>$ sudo certbot --nginx
</pre></div>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ideally, you should see this...</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

<pre><code>Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected: Authenticator nginx, Installer nginx

Which names would you like to activate HTTPS for?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
1: coolcodersjava.pw
2: www.coolcodersjava.pw
3: ajarcade.duckdns.org
4: flowhealth.duckdns.org
5: goatedgroup.duckdns.org
6: jasj-inventory.duckdns.org
7: recipies.duckdns.org
8: ssvgcars.duckdns.org
9: userapi.duckdns.org
10: fr0st.ml
11: www.fr0st.ml
12: agenda.nighthawkcodescrums.gq
13: coolcoders.nighthawkcodescrums.gq
14: escaperoom.nighthawkcodescrums.gq
15: frost.nighthawkcodescrums.gq
16: jame.nighthawkcodescrums.gq
17: lawnmowers.nighthawkcodescrums.gq
18: loopholegames.nighthawkcodescrums.gq
19: musicmania.nighthawkcodescrums.gq
20: nba.nighthawkcodescrums.gq
21: sadv.nighthawkcodescrums.gq
22: ssjn.nighthawkcodescrums.gq
23: stocks.nighthawkcodescrums.gq
24: striver.nighthawkcodescrums.gq
25: tngc.nighthawkcodescrums.gq
26: white.nighthawkcodescrums.gq
27: workwatch.nighthawkcodescrums.gq
28: cars.nighthawkcodingsociety.com
29: dolphin.nighthawkcodingsociety.com
30: saakd.nighthawkcodingsociety.com
31: pythonalflask.tk
32: www.pythonalflask.tk
33: teambrobro.tk
34: www.teambrobro.tk
35: teamcheeseatimetime.tk
36: www.teamcheeseatimetime.tk
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate numbers separated by commas and/or spaces, or leave input
blank to select all options shown (Enter 'c' to cancel): # ENTER YOUR CORRESPONDING NUMBER

Cert not yet due for renewal

You have an existing certificate that has exactly the same domains or certificate name you requested and isn't close to expiry.
(ref: /etc/letsencrypt/renewal/nighthawkcodingsociety.com-0001.conf)

What would you like to do?
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
1: Attempt to reinstall this existing certificate
2: Renew &amp; replace the cert (limit ~5 per 7 days)
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate number [1-2] then [enter] (press 'c' to cancel): 2
Renewing an existing certificate
Performing the following challenges:
http-01 challenge for nighthawkcodingsociety.com
http-01 challenge for csa.nighthawkcodingsociety.com
http-01 challenge for cso.nighthawkcodingsociety.com
http-01 challenge for flm.nighthawkcodingsociety.com
Waiting for verification...
Cleaning up challenges
Deploying Certificate to VirtualHost /etc/nginx/sites-enabled/nighthawk_society
Deploying Certificate to VirtualHost /etc/nginx/sites-enabled/nighthawk_csa
Deploying Certificate to VirtualHost /etc/nginx/sites-enabled/nighthawk_csp
Deploying Certificate to VirtualHost /etc/nginx/sites-enabled/nighthawk_flm

Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
1: No redirect - Make no further changes to the webserver configuration.
2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for
new sites, or if you're confident your site works on HTTPS. You can undo this
change by editing your web server's configuration.
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Select the appropriate number [1-2] then [enter] (press 'c' to cancel): 2
Traffic on port 80 already redirecting to ssl in /etc/nginx/sites-enabled/nighthawk_society
Traffic on port 80 already redirecting to ssl in /etc/nginx/sites-enabled/nighthawk_csa
Traffic on port 80 already redirecting to ssl in /etc/nginx/sites-enabled/nighthawk_csp
Traffic on port 80 already redirecting to ssl in /etc/nginx/sites-enabled/nighthawk_flm

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Your existing certificate has been successfully renewed, and the new certificate
has been installed.

The new certificate covers the following domains:
https://nighthawkcodingsociety.com, 
https://csa.nighthawkcodingsociety.com, 
https://csp.nighthawkcodingsociety.com, and
https://flm.nighthawkcodingsociety.com,

You should test your configuration at:
https://www.ssllabs.com/ssltest/analyze.html?d=nighthawkcodingsociety.com
https://www.ssllabs.com/ssltest/analyze.html?d=csa.nighthawkcodingsociety.com
https://www.ssllabs.com/ssltest/analyze.html?d=csp.nighthawkcodingsociety.com
https://www.ssllabs.com/ssltest/analyze.html?d=flm.nighthawkcodingsociety.com
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at:
   /etc/letsencrypt/live/nighthawkcodingsociety.com-0001/fullchain.pem
   Your key file has been saved at:
   /etc/letsencrypt/live/nighthawkcodingsociety.com-0001/privkey.pem
   Your cert will expire on 2022-03-06. To obtain a new or tweaked
   version of this certificate in the future, simply run certbot again
   with the "certonly" option. To non-interactively renew *all* of
   your certificates, run "certbot renew"
 - If you like Certbot, please consider supporting our work by:

   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
   Donating to EFF:                    https://eff.org/donate-le</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Nearing-Completion!">Nearing Completion!<a class="anchor-link" href="#Nearing-Completion!"> </a></h2><ul>
<li><p>You should be nearly done!</p>
</li>
<li><p>Now, you want to update deployment. To update all your code, run the following;</p>
<div class="highlight"><pre><span></span>$ sudo docker-compose <span class="nb">kill</span>
Killing flask_portfolio_web_1 ... <span class="k">done</span>
</pre></div>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>You may see an error, now, so run git pull. </li>
</ul>
<div class="highlight"><pre><span></span>$ git pull
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Now rebuild...<div class="highlight"><pre><span></span>$ sudo docker-compose build --no-cache
</pre></div>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>All you have to do now is run</li>
</ul>
<div class="highlight"><pre><span></span>$ sudo docker-compose up -d
Recreating flask_portfolio_web_1 ... <span class="k">done</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>If this works succesfully, you should see your server back up with any changes or updates you just made to it. Congrats!</li>
</ul>

</div>
</div>
</div>
</div>
 

